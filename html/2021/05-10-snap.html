<!DOCTYPE html>

<html lang="ru">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Snap</title>

  <link rel="stylesheet" type="text/css" href="../main.css"/>
</head>

<body><h2>Snap - пакет</h2>
<div>
  
<style>
  pre {
    background-color: #F0F0F0;
  }
</style>

<p>
  <a href="https://github.com/Vostok-space/vostok/tree/master/package/snap">Добавил</a>
  возможность собирать snap-пакеты, которые позволяют установку программы в самых 
  разных дистрибутивах GNU/Linux, но, в первую очередь, в Ubuntu. Snap не лишена недостатков, но 
  в одном ряду со сборкой rpm и, тем более, deb она показалось самой простой и логичной для разработчика.
</p>
  
<!-- more -->
  
<p>
  Для полноценной работы транслятору нужен доступ к вызову компиляторов, а также заголовочным файлам и библиотекам,
  что в нынешнем состоянии требует классического доступа(classic confinement), который 
  для возможности выкладывания в Snap Store требует ручного одобрения после проверки. Сегодня проект получил такое
  одобрение, поэтому теперь транслятор доступен для стандартной установки через 
  <a href="https://snapcraft.io/vostok">Snap</a>:
  <pre><code>snap install vostok --classic --beta &&
snap alias vostok ost # добавляем краткий псевдоним</code></pre>
</p>

<iframe src="https://snapcraft.io/vostok/embedded?button=white&channels=true&summary=true" frameborder="0" width="100%" height="300px" style="border: 1px solid #CCC; border-radius: 2px;"></iframe>
  
<p>
  Canonical предоставляет бесплатную сборочную систему для свободных проектов, упаковываемых в snap-пакеты, и
  так как в системе доступны архитектуры, недоступные мне напрямую, 
  то я с интересом воспользовался этой возможностью.
  Из-за этого побочным продуктом создания snap-пакетов оказалась сборка и тестирование транслятора для IBM-вских
  архитектур 
  <a href="https://wiki.ubuntu.com/ppc64el">PowerPC 64-bit Little-endian</a>
  и
  <a href="https://wiki.ubuntu.com/S390X">IBM Z(S390X)</a>.
  На Power PC всё заработало сразу, а на IBM Z из-за порядка байт от старшего к младшему произошла накладка
  с сигнализирующей неопределённостью(signaling NaN), 
  используемой в качестве недопустимого значения для дробей. Поскольку современные системы
  всё равно обычно игнорируют сигнальный характер этого значения, то я перевёл на использование по умолчанию
  обычной неопределёности. После этого всё заработало и на S390X. 
  Несколько позднее я исправил создание сигнальной неопределённости и для big endian.
</p>
<p>
  Не нашёл сведений в открытом доступе, поэтому не исключаю, что
  это первый такой транслятор Oberon, доступный на этих системах. Вдруг, кому-то не хватало?
</p>

<p>
  Отмечу, что multipass, который применяется по умолчанию для сборки snap пакета, показал себя крайне
  неудобным - требует около 30 Гиб на системном разделе и блокирует возможность запуска виртуальных
  машин в Virtualbox. Есть более экономный LXD, для задействования которого
  нужно запускать сборку с соответстующим ключом:
  <pre><code>snapcraft --use-lxd</code></pre>
  <!--Но он показал себя ещё хуже - при некоторых обстоятельствах полученный пакет работает неправильно.
  Так что удобней всего оказалась удалённая сборка на серверах Canonical
  <pre><code>snapcraft remote-build</code></pre-->
</p>
</div>

</body>
</html>
